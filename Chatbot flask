from flask import Flask, jsonify
import serial
import time
import json

app = Flask(__name__)

# Configure the serial port and baud rate
ser = serial.Serial('/dev/ttyUSB0', 9600)  # Update with your actual serial port

def get_serial_data():
    """Read data from the serial port and return it as a JSON object."""
    while True:
        if ser.in_waiting > 0:
            line = ser.readline().decode('utf-8').strip()
            try:
                data = json.loads(line)
                return data
            except json.JSONDecodeError:
                continue

@app.route('/temperature', methods=['GET'])
def get_temperature():
    data = get_serial_data()
    temperature = data.get('t', 25)  # Default to 25 if no data
    humidity = data.get('h', 50)  # Default to 50 if no data

    # Prepare response in JSON format
    response = {
        'temperature': temperature,
        'humidity': humidity
    }

    return jsonify(response)

if __name__ == '__main__':
    app.run(debug=True)
